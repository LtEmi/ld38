<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>LD38</title>
	<!-- <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
	<link rel="icon" href="assets/favicon.ico" type="image/x-icon">-->
	<link rel="stylesheet" href="style/style.css" type="text/css">
	<script type="text/javascript" src="vendor/phaser.min.js"></script>
	<script type="text/javascript" src="data/parameters.js"></script>
	<script type="text/javascript" src="src/objects.js"></script>
</head>
<body>
	<div id="ld38"></div>
	<p>
		<a href="http://ldjam.com/">Ludum Dare 38</a> by <a href="https://twitter.com/ltemi">@ltemi</a>. 
	</p>
	<p>
		See on <a href="https://github.com/LtEmi/ld38">Github</a>
	</p>
</body>

<script type="text/javascript">
	var game = new Phaser.Game(GAME_WIDTH, GAME_HEIGHT, Phaser.CANVAS, 'ld38', { preload: preload, create: create });
	var currentSpeech = 0;
	
	function preload() {
		for (i in ASSETS) { game.load[ASSETS[i].type](ASSETS[i].name, ASSETS[i].src); };
	}
	
	function create() {
		game.stage.backgroundColor = GAME_BACKGROUND_COLOR;
		bg = game.add.image(0, 0, 'bg');
		item1 = game.add.sprite(400, 130, teacup.itemSprite);
		item1.inputEnabled = true;
		item1.events.onInputOver.add(displaySpeech, this);
		item1.events.onInputOut.add(hideSpeech, this);
		item1.events.onInputDown.add(objectMenu, this);
	}
	
	function displaySpeech() {
		currentSpeech ++;
		characterSpeech = game.add.text(270, 350, '', { fill: TEXT_COLOR });
		characterSpeech.text = "Hello World!";
		character = game.add.sprite(10,300,'character');
		speechBubble = game.add.sprite(180,310,'bubble');
//		item1.events.onInputDown.addOnce(function showNext() {
//			if (currentSpeech > 0) {
//				characterSpeech.destroy();
//				character.destroy();
//				speechBubble.destroy();
//				currentSpeech = 0
//				item1.events.onInputDown.addOnce(displaySpeech, this);
//			}
//		},this);
	}
	function hideSpeech() {
        characterSpeech.destroy();
		character.destroy();
		speechBubble.destroy();
		currentSpeech = 0;
	}
	
	function objectMenu() {
//		UItake = game.add.sprite(150,10,'UItake');
//		UIleave = game.add.sprite(450,10,'UIleave');
//		UItake.inputEnabled = true;
//		UIleave.inputEnabled = true;
//		UIleave.events.onInputDown.addOnce(displaySpeech, this);
//		UItake.events.onInputDown.addOnce(function dragObject(){

//		if (currentSpeech > 0) {	
//			hideSpeech();
//		}

			item1.input.enableDrag();
			item1.events.onDragStart.add(UItakeDisplay, this);
			item1.events.onDragStop.add(UItakeHide, this);
//		});
	}
	
	function UItakeDisplay() {
		hideSpeech();
		objectPosX = item1.x; 
		objectPosY = item1.y; 
		UItake = game.add.sprite(320,500,'UItake');
	}
	function UItakeHide() {
		UItake.destroy();
		if (item1.y > 480){
			item1.scale.setTo(0.5, 0.5);
		}
		else {
			item1.x = objectPosX;
			item1.y = objectPosY;
		}
	}
	
	
</script>
