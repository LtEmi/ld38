<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>LD38</title>
	<!-- <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
	<link rel="icon" href="assets/favicon.ico" type="image/x-icon">-->
	<link rel="stylesheet" href="style/style.css" type="text/css">
	<script type="text/javascript" src="vendor/phaser.min.js"></script>
	<script type="text/javascript" src="data/parameters.js"></script>
	<script type="text/javascript" src="src/objects.js"></script>
</head>
<body>
	<div id="ld38"></div>
	<p>
		<a href="http://ldjam.com/">Ludum Dare 38</a> by <a href="https://twitter.com/ltemi">@ltemi</a>. 
	</p>
	<p>
		See on <a href="https://github.com/LtEmi/ld38">Github</a>
	</p>
</body>

<script type="text/javascript">
	var game = new Phaser.Game(GAME_WIDTH, GAME_HEIGHT, Phaser.CANVAS, 'ld38', { preload: preload, create: create });
	var currentSpeech = 0;
	
	function preload() {
		for (i in ASSETS) { game.load[ASSETS[i].type](ASSETS[i].name, ASSETS[i].src); };
	}
	
	function create() {
		game.stage.backgroundColor = GAME_BACKGROUND_COLOR;
		bg = game.add.image(0, 0, 'bg');
		
		//itemProperties(); todo
		
		teapotSprite = game.add.sprite(teapot.itemPosX, teapot.itemPosY, teapot.itemSprite);
		teacupSprite = game.add.sprite(teacup.itemPosX, teacup.itemPosY, teacup.itemSprite);
		teapotSprite.inputEnabled = true;
		teacupSprite.inputEnabled = true;
		
		//itemActions(); todo
	
		teapotSprite.events.onInputOver.add(displaySpeech0, this);
		teapotSprite.events.onInputOut.add(hideSpeech, this);
		teapotSprite.events.onInputDown.add(objectMenu0, this);
		
		teacupSprite.events.onInputOver.add(displaySpeech1, this);
		teacupSprite.events.onInputOut.add(hideSpeech, this);
		teacupSprite.events.onInputDown.add(objectMenu1, this);
	}
	
	// todo link speech value to items id
	function displaySpeech0() {
		currentSpeech ++;
		characterSpeech = game.add.text(270, 350, '', { fill: TEXT_COLOR });
		characterSpeech.text = "Hello World!";
		displayDoll1();
	}
	function displaySpeech1() {
		currentSpeech ++;
		characterSpeech = game.add.text(270, 350, '', { fill: TEXT_COLOR });
		characterSpeech.text = "Nope.";
		displayDoll1();
	}
	
	function hideSpeech() {
        characterSpeech.destroy();
		hideDoll1();
		currentSpeech = 0;
	}
	
	function objectMenu0() {
		teapotSprite.input.enableDrag();
		teapotSprite.events.onDragStart.add(UItakeDisplay0, this);
		teapotSprite.events.onDragStop.add(UItakeHide0, this);
	}
	function objectMenu1() {
		teacupSprite.input.enableDrag();
		teacupSprite.events.onDragStart.add(UItakeDisplay1, this);
		teacupSprite.events.onDragStop.add(UItakeHide1, this);
	}
	
	function UItakeDisplay0() {
		hideSpeech();
		objectPosX = teapotSprite.x; 
		objectPosY = teapotSprite.y; 
		UItake = game.add.sprite(320,500,'UItake');
	}
	function UItakeHide0() {
		UItake.destroy();
		if (teapotSprite.y > 480){
			teapotSprite.scale.setTo(0.5, 0.5);
		}
		else {
			teapotSprite.x = objectPosX;
			teapotSprite.y = objectPosY;
		}
	}
	function UItakeDisplay1() {
		hideSpeech();
		objectPosX = teacupSprite.x; 
		objectPosY = teacupSprite.y; 
		UItake = game.add.sprite(320,500,'UItake');
	}
	function UItakeHide1() {
		UItake.destroy();
		if (teacupSprite.y > 480){
			teacupSprite.scale.setTo(0.5, 0.5);
		}
		else {
			teacupSprite.x = objectPosX;
			teacupSprite.y = objectPosY;
		}
	}
	
	
</script>
