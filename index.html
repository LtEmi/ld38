<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>LD38</title>
	<!-- <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
	<link rel="icon" href="assets/favicon.ico" type="image/x-icon">-->
	<link rel="stylesheet" href="style/style.css" type="text/css">
	<script type="text/javascript" src="vendor/phaser.min.js"></script>
	<script type="text/javascript" src="data/parameters.js"></script>
</head>
<body>
	<div id="ld38"></div>
	<p>
		<a href="http://ldjam.com/">Ludum Dare 38</a> by <a href="https://twitter.com/ltemi">@ltemi</a>. 
	</p>
	<p>
		See on <a href="https://github.com/LtEmi/ld38">Github</a>
	</p>
</body>

<script type="text/javascript">
	var game = new Phaser.Game(GAME_WIDTH, GAME_HEIGHT, Phaser.CANVAS, 'ld38', { preload: preload, create: create });
	var currentSpeech = 0;
	
	function preload() {
		for (i in ASSETS) { game.load[ASSETS[i].type](ASSETS[i].name, ASSETS[i].src); };
	}
	
	function create() {
		game.stage.backgroundColor = GAME_BACKGROUND_COLOR;
		bg = game.add.image(0, 0, 'bg');
		object1 = game.add.sprite(400, 165, 'object1');
		object1.inputEnabled = true;
		console.log('foo');
		object1.events.onInputOver.add(displaySpeech, this);
		object1.events.onInputOut.add(hideSpeech, this);
		object1.events.onInputDown.add(objectMenu, this);
	}
	
	function displaySpeech() {
		currentSpeech ++;
		characterSpeech = game.add.text(270, 350, '', { fill: TEXT_COLOR });
		characterSpeech.text = "Hello World!";
		character = game.add.sprite(10,300,'character');
		speechBubble = game.add.sprite(180,310,'bubble');
//		object1.events.onInputDown.addOnce(function showNext() {
//			if (currentSpeech > 0) {
//				characterSpeech.destroy();
//				character.destroy();
//				speechBubble.destroy();
//				currentSpeech = 0
//				object1.events.onInputDown.addOnce(displaySpeech, this);
//			}
//		},this);
	}
	function hideSpeech() {
        characterSpeech.destroy();
		character.destroy();
		speechBubble.destroy();
		currentSpeech = 0;
	}
	
	function objectMenu() {
//		UItake = game.add.sprite(150,10,'UItake');
//		UIleave = game.add.sprite(450,10,'UIleave');
//		UItake.inputEnabled = true;
//		UIleave.inputEnabled = true;
//		UIleave.events.onInputDown.addOnce(displaySpeech, this);
//		UItake.events.onInputDown.addOnce(function dragObject(){

//		if (currentSpeech > 0) {	
//			hideSpeech();
//		}

			object1.input.enableDrag();
			object1.events.onDragStart.add(UItakeDisplay, this);
			object1.events.onDragStop.add(UItakeHide, this);
//		});
	}
	
	function UItakeDisplay() {
		hideSpeech();
		UItake = game.add.sprite(320,500,'UItake');
	}
	function UItakeHide() {
		UItake.destroy();
	}
	
	
</script>
